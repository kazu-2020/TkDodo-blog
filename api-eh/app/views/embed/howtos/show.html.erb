<% content_for(:title, @howto_data[:name]) %>

<div class="embed embed-howto rounded-sm shadow-md text-white border border-gray-450">
  <a href="<%= @howto_data[:url] %>" target="_blank">
    <!-- - height:250px -->
    <div class="card:hidden h-full">
      <!-- < width:241px-->
      <div class="xxxs:hidden xs:hidden flex flex-col justify-between h-full p-3">
        <div class="grid grid-cols-12 gap-3 mb-auto">
          <div class="col-span-12">
            <img
              decoding="async"
              src="<%= howto_image_src %>"
              class="rounded-sm"
              alt="<%= @howto_data[:name] %>"/>
            <div class="my-2"></div>
            <div class="text-xs line-clamp-1">
              <span style="color: <%= @episode_data.dig(:partOfSeries, :style, :primaryLight) %>"><%= @episode_data.dig(:identifierGroup, :seriesName) %></span>
            </div>
            <div class="font-bold text-sm mt-1 mb-2 w-54 line-clamp-2"><%= @howto_data[:name] %></div>
          </div>
        </div>
      </div>

      <!-- >= width:241px -->
      <div class="invisible xxxs:visible flex flex-col justify-between h-full p-3">
        <div class="flex mb-auto h-full">
          <div class="flex-auto flex flex-col">
            <div class="text-xs line-clamp-2">
              <span style="color: <%= @episode_data.dig(:partOfSeries, :style, :primaryLight) %>"><%= @episode_data.dig(:identifierGroup, :seriesName) %></span>
            </div>

            <div class="font-bold text-md mt-1 mb-2 line-clamp-2">
              <%= @howto_data[:name] %>
            </div>

            <div class="text-gray-350 text-sm mt-2 line-clamp-3">
              <%= @howto_data[:description] %>
            </div>

            <div class="mt-2">
            </div>
          </div>
          <div class="w-32 xxs:w-48 flex-none flex flex-col justify-between ml-3">
            <div>
              <img
                decoding="async"
                src="<%= howto_image_src %>"
                class="rounded-sm"
                alt="<%= @howto_data[:name] %>"/>
              <div class="mt-2">
                <button
                  class="w-full bg-yellow-500 hover:bg-yellow-400 text-white py-2 sm:px-10 rounded-sm text-xs"
                >
                  詳しく見る
                </button>
              </div>
            </div>
            <div class="flex justify-end">
              <%= render 'shared/embed_logo' %>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- >= height:251px -->
    <div class="small:hidden h-full">
      <!-- < width:241px-->
      <div class="xxs:hidden xs:hidden flex flex-col justify-between h-full p-3">
        <div class="grid grid-cols-12 gap-3 mb-auto">
          <div class="col-span-12">
            <img
              decoding="async"
              src="<%= howto_image_src %>"
              class="rounded-sm"
              alt="<%= @howto_data[:name] %>"/>
            <div class="my-2"></div>
            <div class="text-xs line-clamp-2">
              <span style="color: <%= @episode_data.dig(:partOfSeries, :style, :primaryLight) %>"><%= @episode_data.dig(:identifierGroup, :seriesName) %></span>
            </div>

            <div class="font-bold text-sm mt-1 mb-2 w-54 line-clamp-2"><%= @howto_data[:name] %></div>

            <div class="text-gray-350 text-xs mt-2 line-clamp-2"><%= @howto_data[:description] %></div>
          </div>
        </div>
      </div>

      <!-- >= width:241px -->
      <div class="invisible xxs:visible h-full p-3">
        <div class="flex mb-auto h-full">
          <div class="flex-auto flex flex-col">
            <div class="flex-none">
              <div class="text-xs line-clamp-2">
                <span style="color: <%= @episode_data.dig(:partOfSeries, :style, :primaryLight) %>"><%= @episode_data.dig(:identifierGroup, :seriesName) %></span>
              </div>

              <div class="font-bold text-md mt-1 mb-2 line-clamp-2">
                <%= @howto_data[:name] %>
              </div>

              <div class="text-gray-350 text-sm my-2 line-clamp-3">
                <%= @howto_data[:description] %>
              </div>
            </div>
            <div class="steps h-full">
                <div class="h-full border-t border-gray-350 pt-2">
                  <% @howto_data[:section].each do |section| %>
                    <div class="flex items-center font-bold mb-2">
                      <span class="material-icons">
                        format_list_numbered
                      </span>
                      <span class="ml-2 text-sm"><%= section[:name] %></span>
                    </div>
                    <ol class="step-list list-decimal list-inside text-gray-350">
                      <% section[:step].take(8).each do |step| %>
                        <li class="mb-1 flex">
                          <span class="text-sm line-clamp-1"><%= step[:name] %></span>
                        </li>
                      <% end %>
                    </ol>
                  <% end %>
                </div>
            </div>
          </div>
          <div class="w-32 xxs:w-48 flex-none flex flex-col justify-between ml-3">
            <div>
              <img
                decoding="async"
                src="<%= howto_image_src %>"
                class="rounded-sm"
                alt="<%= @howto_data[:name] %>"/>
              <div class="mt-2">
                <button
                  class="w-full bg-yellow-500 hover:bg-yellow-400 text-white py-2 sm:px-10 rounded-sm text-xs"
                >
                  詳しく見る
                </button>
              </div>
            </div>
            <div class="flex justify-end">
              <%= render 'shared/embed_logo' %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </a>
</div>

<% content_for(:style) do %>
  <style>
      .embed-howto {
          height: <%= @height %>px;
          overflow: hidden;
          min-width: 240px;
      }

      @media (max-height: 250px) {
          .small\:hidden {
              display: none !important;
          }
      }

      @media (min-height: 251px) {
          .card\:hidden {
              display: none !important;
          }
      }

      .steps {
          overflow: hidden;
      }

      .steps ol {
          counter-reset: step-counter;
          list-style: none;
          padding: 0;
          margin: 0;
      }

      .steps li {
          font-size: 16px;
          line-height: 1.5;
          padding-left: 30px;
          position: relative;
      }

      .steps li::before {
          content: counter(step-counter);
          counter-increment: step-counter;
          background-color: #fff;
          border: 1px solid;
          border-radius: 50%;
          box-sizing: border-box;
          display: flex;
          justify-content: center;
          align-items: center;
          height: 18px;
          width: 18px;
          color: #333;
          font-size: 85%;
          line-height: 1;
          position: absolute;
          top: 0;
          left: 0;
      }

      /* ステップの最大の高さをはみ出る場合用 */
      .steps::after  {
          display: block;
          position: relative;
          background: linear-gradient(180deg, rgba(20, 20, 20, 0) 25%, #343434 90%);
          backdrop-filter: blur(1px);
          bottom: 20px;
          height: 24px;
          max-width: 100%;
          content: '';
      }
  </style>
<% end %>
